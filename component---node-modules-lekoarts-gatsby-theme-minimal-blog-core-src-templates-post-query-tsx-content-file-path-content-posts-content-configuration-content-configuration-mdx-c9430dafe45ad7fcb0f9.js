"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[922],{4765:function(e,t,n){n.d(t,{F:function(){return m},Z:function(){return g}});var l=n(7294),i=n(8733),a=n(795),o=n(2685),r=n(6799),c=n(8871);var s=e=>{let{post:t}=e;return null};const u=["16px","8px","4px"].map((e=>"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"));var d=e=>{let{data:{post:t},children:n}=e;return(0,i.tZ)(o.Z,null,(0,i.tZ)(a.X6,{as:"h1",variant:"styles.h1"},t.title),(0,i.tZ)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,i.tZ)("time",null,t.date),t.tags&&(0,i.tZ)(l.Fragment,null," â€” ",(0,i.tZ)(r.Z,{tags:t.tags})),t.timeToRead&&" â€” ",t.timeToRead&&(0,i.tZ)("span",null,t.timeToRead," min read")),(0,i.tZ)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:u.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},n),(0,i.tZ)(s,{post:t}))};const m=e=>{var t,n,l;let{data:{post:a}}=e;return(0,i.tZ)(c.Z,{title:a.title,description:a.description?a.description:a.excerpt,image:a.banner?null===(t=a.banner)||void 0===t||null===(n=t.childImageSharp)||void 0===n||null===(l=n.resize)||void 0===l?void 0:l.src:void 0,pathname:a.slug,canonicalUrl:a.canonicalUrl})};function g(e){let{...t}=e;return l.createElement(d,t)}},6799:function(e,t,n){var l=n(8733),i=n(7294),a=n(1883),o=n(3494),r=n(9706);t.Z=e=>{let{tags:t}=e;const{tagsPath:n,basePath:c}=(0,o.Z)();return(0,l.tZ)(i.Fragment,null,t.map(((e,t)=>(0,l.tZ)(i.Fragment,{key:e.slug},!!t&&", ",(0,l.tZ)(a.Link,{sx:e=>{var t;return{...null===(t=e.styles)||void 0===t?void 0:t.a}},to:(0,r.Z)("/"+c+"/"+n+"/"+e.slug)},e.name)))))}},8871:function(e,t,n){var l=n(7294),i=n(1883),a=n(4232);t.Z=e=>{let{title:t="",description:n="",pathname:o="",image:r="",children:c=null,canonicalUrl:s=""}=e;const u=(0,a.Z)(),{siteTitle:d,siteTitleAlt:m,siteUrl:g,siteDescription:p,siteImage:h,author:f,siteLanguage:w}=u,b={title:t?t+" | "+d:m,description:n||p,url:""+g+(o||""),image:""+g+(r||h)};return l.createElement(l.Fragment,null,l.createElement("html",{lang:w}),l.createElement("title",null,b.title),l.createElement("meta",{name:"description",content:b.description}),l.createElement("meta",{name:"image",content:b.image}),l.createElement("meta",{property:"og:title",content:b.title}),l.createElement("meta",{property:"og:url",content:b.url}),l.createElement("meta",{property:"og:description",content:b.description}),l.createElement("meta",{property:"og:image",content:b.image}),l.createElement("meta",{property:"og:type",content:"website"}),l.createElement("meta",{property:"og:image:alt",content:b.description}),l.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),l.createElement("meta",{name:"twitter:title",content:b.title}),l.createElement("meta",{name:"twitter:url",content:b.url}),l.createElement("meta",{name:"twitter:description",content:b.description}),l.createElement("meta",{name:"twitter:image",content:b.image}),l.createElement("meta",{name:"twitter:image:alt",content:b.description}),l.createElement("meta",{name:"twitter:creator",content:f}),l.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),l.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,i.withPrefix)("/favicon-32x32.png")}),l.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,i.withPrefix)("/favicon-16x16.png")}),l.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,i.withPrefix)("/apple-touch-icon.png")}),s?l.createElement("link",{rel:"canonical",href:s}):null,c)}},9018:function(e,t,n){n.r(t),n.d(t,{Head:function(){return r.F},default:function(){return c}});var l=n(7294),i=n(1151);function a(e){const t=Object.assign({p:"p",code:"code",h2:"h2",h3:"h3",em:"em",ul:"ul",li:"li",span:"span",strong:"strong",pre:"pre",a:"a",blockquote:"blockquote"},(0,i.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.p,null,"Today we're showcasing how to migrate an existing ",l.createElement(t.code,null,"UICollectionViewCell")," subclass into the\nnew modern technique using ",l.createElement(t.code,null,"UIContentConfiguration")," and ",l.createElement(t.code,null,"UIContentView"),". Let's go!"),"\n",l.createElement(t.h2,null,"What the... content?"),"\n",l.createElement(t.p,null,"iOS 14 brought a modern techique to build and configure collection views by leveraging the\nnew protocol ",l.createElement(t.code,null,"UIContentConfiguration"),".\nThis not only offers a performant way to represent cell's data structures, but also gives it\na canonical way of dealing with state changes, all while conforming to modern standards\nand offering builtin swift type-safety."),"\n",l.createElement(t.p,null,"This completes the puzzle first introduced in iOS 13 with the addition of new modern ways to\ncreate collection views using ",l.createElement(t.code,null,"UIDiffableDataSource")," and ",l.createElement(t.code,null,"UICollectionViewCompositionalLayout"),"."),"\n",l.createElement(t.h3,null,"When the stock solution isn't enough"),"\n",l.createElement(t.p,null,"iOS 14 also introduced simpler and leaner ",l.createElement(t.code,null,"UICollectionViewListCell"),", which takes away\nsome of the burden of the cell definitions, by adding a built-in state, accessories and content and\nbackground configurations."),"\n",l.createElement(t.p,null,"Even having ",l.createElement(t.code,null,"UICollectionViewListCell"),", we sometimes need to define custom layouts for our cells.\nThis is also true for content: the cell's ",l.createElement(t.code,null,"UIListContentConfiguration")," is quite limited,\noffering only a handful of the most common uses, such as text properties\nand static images. But what if we need to define a slightly more complex layout?"),"\n",l.createElement(t.p,null,"When ",l.createElement(t.em,null,"not")," to use ",l.createElement(t.code,null,"UIListContentConfiguration"),":"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"the images come from a url, instead of from a static source"),"\n",l.createElement(t.li,null,"we use different trailing markers as the ones provided in the accessories"),"\n",l.createElement(t.li,null,"we have a complex layout, outside title/subtitle/icon"),"\n",l.createElement(t.li,null,"we use shadows, layer transformations, etc."),"\n"),"\n",l.createElement(t.h3,null,"A Simple(ish) Cell"),"\n",l.createElement(t.p,null,"Consider this cell UI:"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 718px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVR42o2QzUoDQRCE9zW9CoI3QU+CePQiPoG+weYBvAU8CJ6CLEuisBdlA1H2d2YymVlmP7cHIjmmoeiupqiCSrz3WN1Rb77x3hHGERgJITAMw9EQvXM7Euss76/PpHdXfC7m9EqRZRl5njNG8+MmeHBmICmWS55urnk4O2E+e6SqflitPiiKAmMMXdfFrbX+v621qClYfloZAjvWC/h6mwx/yzX3F5fcnp/ykqYxTcRN00SDtm3pezWhjz/hYlRVFXVdRwiXGfxk6JyLwrIspw48wqXXPaSfw3vPD/sTLv1tt4Y/UdN5icFYwtYAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="A Simple Cell"\n        title=""\n        src="/static/28d175f2453a31683e1f7d21ccfdfa9d/75a23/simple-cell.png"\n        srcset="/static/28d175f2453a31683e1f7d21ccfdfa9d/5243c/simple-cell.png 240w,\n/static/28d175f2453a31683e1f7d21ccfdfa9d/ab158/simple-cell.png 480w,\n/static/28d175f2453a31683e1f7d21ccfdfa9d/75a23/simple-cell.png 718w"\n        sizes="(max-width: 718px) 100vw, 718px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(t.p,null,"To configure it, we'll need these basic properties:"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,l.createElement(t.strong,null,"Title")),"\n",l.createElement(t.li,null,l.createElement(t.strong,null,"Subtitle")),"\n",l.createElement(t.li,null,l.createElement(t.strong,null,"Image")),"\n",l.createElement(t.li,null,l.createElement(t.strong,null,"isRead indicator")),"\n"),"\n",l.createElement(t.p,null,"The layout is simple enough, but in this case we can't use the stock ",l.createElement(t.code,null,"UIListContentConfiguration"),".\nThis is because the image is not a static image from assets, and instead comes from a url.\nMoreover, we need to add a trailing indicator (the purple dot), to inform the user whether\nthe contents of this cell are read or not.\nThose properties are not handled in the defaultContentConfiguration(), so we'll need\nto define our own."),"\n",l.createElement(t.h3,null,"Starting point"),"\n",l.createElement(t.p,null,"Let's see the starting point we had, since you probably have something similar\nin your codebase."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},'public class SimpleCollectionViewCell: UICollectionViewListCell {\n\n    private var titleLabel: UILabel!\n    private var subtitleLabel: UILabel!\n    private var photoImageView: UIImageView!\n    private var trailingIndicator: UIImageView!\n\n    override init(frame: CGRect) {\n        super.init(frame: frame)\n\n        /// Layout Code\n    }\n\n    required init?(coder aDecoder: NSCoder) {\n        fatalError("init(coder:) has not been implemented")\n    }\n\n    override public var isSelected: Bool {\n        didSet {\n            if isSelected {\n                contentView.backgroundColor = .cellSelectionBackgroundColor\n            } else {\n                contentView.backgroundColor = .defaultBackgroundColor\n            }\n        }\n    }\n\n    override public var isHighlighted: Bool {\n        didSet {\n            contentView.backgroundColor = isHighlighted ?\n                UIColor.systemGray3 :\n                UIColor.defaultBackgroundColor\n        }\n    }\n}\n')),"\n",l.createElement(t.p,null,"This cell has a couple of labels and image views. To render its contents,\nit defines a ",l.createElement(t.code,null,"ViewModel")," (which holds the data) and a method to configure its subviews\nas such:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"extension SimpleCollectionViewCell {\n    public struct ViewModel: Hashable {\n        public let id: String\n        public let photo: UIImage\n        public let title: String\n        public let subtitle: String?\n        public let isRead: Bool\n    }\n\n    public func configureFor(viewModel: ViewModel) {\n        titleLabel.text = viewModel.title\n        subtitleLabel.text = viewModel.subtitle\n        photoImageView.image = viewModel.photo\n        trailingIndicator.isHidden = viewModel.isRead\n    }\n}\n")),"\n",l.createElement(t.p,null,"When we dequeue the cell from the collection view, we just need to call\n",l.createElement(t.code,null,"configureFor")," method to properly populate our subviews with the data."),"\n",l.createElement(t.p,null,"Below you can see how we would implement a ",l.createElement(t.code,null,"UICollectionDiffableDataSource"),",\ndequeueing this cell:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"let simpleCellRegistration = UICollectionView.CellRegistration\n    <SimpleCollectionViewCell, SimpleCollectionViewCell.ViewModel> { (cell, indexPath, vm) in\n    cell.configureFor(viewModel: vm)\n}\n\nlet dataSource = UICollectionViewDiffableDataSource<Section, Item>\n    .init(collectionView: collectionView) { (cv, indexPath, item) -> UICollectionViewCell? in\n    switch item {\n    case .simpleCell(let vm):\n        return cv.dequeueConfiguredReusableCell(\n            using: simpleCellRegistration,\n            for: indexPath,\n            item: vm\n        )\n        ...\n    }\n}\n...\nenum Section {\n    case onlySection\n}\n\nenum Item: Hashable {\n    case simpleCell(SimpleCollectionViewCell.ViewModel)\n}\n")),"\n",l.createElement(t.p,null,"We ensure the type passed to the cell is appropriate by making the ",l.createElement(t.code,null,"Item"),"\ncontain the ",l.createElement(t.code,null,"SimpleCollectionViewCell.ViewModel"),", so that when we call the registration\nhandler that type is the ViewModel for this particular item."),"\n",l.createElement(t.p,null,"Below is a diagram depicting the process from dequeueing the cell to displaying it,\nup until now:"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 85.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAC4jAAAuIwF4pT92AAACoUlEQVR42oVTW0/TYBjmh3pljDFyod4IBBODF0TxQjFyiFEE7YCd2WIdxDgQBm6OtdMIhLWDHboetrJ2Pazt18N4t5EAZuqTN1/eiz7f83zv+3RIFEUboXKNTe4TW2T+a46A2iTITSK/mSOFhogQMgzD7KHfaJrmui5FUUOqqnY6ndTvwxvTs/cWPo4vB8d8/hFsdfjt0s2ZN7/oomW0VVWTZbnVaimKAqfneUCpVCpDcA10xRrrS24HU+nwbjqwsxfezQR2vq9+S9UaDddxLMvqa0IDJ8hekHVdhw4uc5BlI1NVZIFnkdW2TcOxUWcQLsma3lWGGxcD8761d7ENfwjH1jb8i8G5II7ZtgOaeg99ZaMHoNA0DcoX5KXg3FJoNprAIgksuu5b8L8K4xh8LUkSvBNOmA5cAT281LbtQqFwabuNPN1yZdXgRVk3Hc10TeT9x3af7DiofoQ3j6L1g2glt3x2HBcPwiKddF3PcRzQgYUBx+vhKrlrG5l6IXanhN8uJe5W1odLieHSp1vFjbG2YYJPyALP832ZAcqwD5nJt5h9qZJtnKaVGiFXsy3uEDbqXccAsmVoqsTqMifVT5nTQ01iNIlVmwws75+r0roJa1bJ6pcH/PYjPjXB7TwWUk+4rVEmOXLGUU1ZERsNSBiY5zgO9vRnwpQ6zey94LPzQt7H57H6Tx+beV3LzOiy4HodmJbTA0zO7eH6m13XsrulqKpQr0MaTMuxkNsX+attCDt0JEVPLAemIrHpOP48tPYy/vlpMDoZiFBVxuoFy70C0AdKuVyGv6pr+8dx4f57bHwlNBXDn8XwyUh81Bd4+GHlqFRGpgm2BytDyliWPS5QaYJIk+Tufg5qL0dkSBKqeHICQ6oyTPUKgCYIQjabPQeRlo39lqM2CgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Diagram of the starting point"\n        title=""\n        src="/static/7cc77c1883f1e514d98d342c0e2d20b5/7d769/diagram0.png"\n        srcset="/static/7cc77c1883f1e514d98d342c0e2d20b5/5243c/diagram0.png 240w,\n/static/7cc77c1883f1e514d98d342c0e2d20b5/ab158/diagram0.png 480w,\n/static/7cc77c1883f1e514d98d342c0e2d20b5/7d769/diagram0.png 960w,\n/static/7cc77c1883f1e514d98d342c0e2d20b5/87339/diagram0.png 1440w,\n/static/7cc77c1883f1e514d98d342c0e2d20b5/afa98/diagram0.png 1609w"\n        sizes="(max-width: 960px) 100vw, 960px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(t.p,null,"Notice the creation and configuration steps are done sepparately. Thus, we need to remember\nconfiguring the cell after dequeuing it."),"\n",l.createElement(t.p,null,"This is easy enough, and for most cases it just works. Let's now see how we can move\non to modern cell configurations and see what value this can bring us."),"\n",l.createElement(t.h2,null,"Moving to ",l.createElement(t.code,null,"UIContentConfiguration")),"\n",l.createElement(t.p,null,"We want to migrate this ",l.createElement(t.code,null,"ViewModel")," to the new technique ",l.createElement(t.code,null,"UIContentConfiguration"),", wich will\nhandle not only the data the cell needs (id, photo, title, subtitle and isRead),\nbut also the cell state, including our familiar properties when building lists\nsuch as ",l.createElement(t.code,null,"isSelected")," and ",l.createElement(t.code,null,"isHighlighted"),"."),"\n",l.createElement(t.p,null,"The great thing about this new protocol is that we'll be able to decouple our view layout\nfrom ",l.createElement(t.code,null,"UICollectionViewCell"),". This way, we'll have a composable structure that we can reuse\nelsewhere in our code, if need be."),"\n",l.createElement(t.p,null,"First we want to take a look at the ",l.createElement(t.code,null,"UIContentConfiguration")," protocol:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public protocol UIContentConfiguration {\n\n    /// Initializes and returns a new instance of the content view using this configuration.\n    func makeContentView() -> UIView & UIContentView\n\n    /// Returns the configuration updated for the specified state,\n    /// by applying the configuration's default values for that state\n    /// to any properties that have not been customized.\n    func updated(for state: UIConfigurationState) -> Self\n}\n")),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,l.createElement(t.code,null,"makeContentView()")," ensures that the configuration creates a new view to serve\nas a contentView for the cell. This view needs to be both a ",l.createElement(t.code,null,"UIView"),"\nand a ",l.createElement(t.code,null,"UIContentView"),", which enforces that the view has a ",l.createElement(t.code,null,"UIContentConfiguration")," stored."),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,l.createElement(t.code,null,"updated(for:)")," returns a new configuration applying a given state.\nThis will allow us to, for example, change the cell background color when the user taps it."),"\n"),"\n"),"\n",l.createElement(t.p,null,"Our custom configuration will have to implement both functions. We'll define it as follows:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public struct Configuration: UIContentConfiguration {\n    public let id: String\n    public let photo: UIImage\n    public let title: String\n    public let subtitle: String?\n\n    private(set) var state: UICellConfigurationState?\n\n    public init(\n        id: String,\n        photo: UIImage,\n        title: String,\n        subtitle: String?,\n        state: UICellConfigurationState? = nil\n    ) {\n        self.id = id\n        self.photo = photo\n        self.title = title\n        self.subtitle = subtitle\n        self.state = state\n    }\n\n    public func makeContentView() -> UIView & UIContentView {\n        View(configuration: self) // To be defined\n    }\n\n    public func updated(for state: UIConfigurationState) -> SimpleCell.Configuration {\n        var mutableCopy = self\n        if let cellState = state as? UICellConfigurationState {\n            mutableCopy.state =  cellState\n        }\n        return mutableCopy\n    }\n\n}\n")),"\n",l.createElement(t.p,null,"Here we moved all the code in the ",l.createElement(t.code,null,"ViewModel")," struct into this new ",l.createElement(t.code,null,"Configuration")," type.\nWe also added the ",l.createElement(t.code,null,"state")," property on it, which will hold relevant properties\nsuch as ",l.createElement(t.code,null,"isSelected")," or ",l.createElement(t.code,null,"isHighlighted"),". This object is created by UIKit when the user\ninteracts with cells in lists."),"\n",l.createElement(t.p,null,"Also, the ",l.createElement(t.code,null,"updated(for: UIConfigurationState)")," function is now very straightforward:\nsince we're using a ",l.createElement(t.code,null,"struct")," to hold this data, we can add a new variable\nand just use ",l.createElement(t.code,null,"self")," and let copy-on-write do its job. This allows this function to just\nmutate the new properties, and to return a fresh copy for the view to be reconfigured."),"\n",l.createElement(t.p,null,"We also need to define our view. It must be both ",l.createElement(t.code,null,"UIView")," and ",l.createElement(t.code,null,"UIContentView"),".\nThat in turn requires that it has a configuration set in.\nFurthermore, it will have a ",l.createElement(t.code,null,"init(configuration:)"),", so that it can be instantiantiated\nfrom the ",l.createElement(t.code,null,"makeView()")," method."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public class View: UIView & UIContentView {\n    public var configuration: UIContentConfiguration\n\n    ...\n\n    init(configuration: Configuration) {\n        self.configuration = configuration\n        super.init(frame: .zero)\n        ...\n        // Layout Code\n\n        configureFor(configuration: configuration)\n    }\n}\n")),"\n",l.createElement(t.p,null,"In the ",l.createElement(t.code,null,"init")," method, we'll also include all the layout code the previous ",l.createElement(t.code,null,"SimpleCollectionViewCell"),"\nhad. Note also that here we must configure the view, meaning populating its\n",l.createElement(t.code,null,"UILabel"),", ",l.createElement(t.code,null,"UIImageView"),", etc. with actual content, which is passed in the ",l.createElement(t.code,null,"init")," method."),"\n",l.createElement(t.p,null,"This ",l.createElement(t.code,null,"configureFor(configuration:)")," has basically the same code it had before, but it will also\ncontain the code to style the state changes in the cell"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public func configureFor(configuration: Configuration) {\n    titleLabel.text = configuration.title\n    subtitleLabel.text = configuration.subtitle\n    photoImageView.image = configuration.photo\n    if let state = configuration.state {\n        backgroundColor = {\n            if state.isSelected {\n                return .cellSelectionBackgroundColor\n            } else if state.isHighlighted {\n                return .systemGray3\n            } else {\n                return .defaultBackgroundColor\n            }\n        }()\n    } else {\n        backgroundColor = .defaultBackgroundColor\n    }\n}\n")),"\n",l.createElement(t.p,null,"Note that here we merged the two properties related to state, ",l.createElement(t.code,null,"isSelected")," and ",l.createElement(t.code,null,"isHighlighted"),"\nin a single state change. State now doesn't have to be defined all over the ",l.createElement(t.code,null,"UIView")," subclass,\nand it can be set from one single method, simplifiying a lot the code."),"\n",l.createElement(t.p,null,"That was quite a bit of moving around the code, but the code itself keeps being the same.\nNow we have a cell configured and ready to display from the get-go. But how would we use this in a\ncollection view?"),"\n",l.createElement(t.h3,null,"Configuring our ",l.createElement(t.code,null,"UICollectionViewDiffableDataSource")),"\n",l.createElement(t.p,null,"We now have a working ",l.createElement(t.code,null,"UIView")," with all it's inputs and outputs well defined. At this stage,\nwe recommend adding ",l.createElement(t.a,{href:"https://github.com/pointfreeco/swift-snapshot-testing"},"snapshot tests"),"\nto make sure the view looks exactly like you'd expect."),"\n",l.createElement(t.p,null,"Now, to use this view as a cell in a ",l.createElement(t.code,null,"UICollectionView"),", there's a secret that we haven't\ntold you: beggining iOS 14 ",l.createElement(t.code,null,"UICollectionViewCell")," defines a new property:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"@available(iOS 14.0, tvOS 14.0, *)\nextension UICollectionViewCell {\n    @available(iOS 14.0, tvOS 14.0, *)\n    public var contentConfiguration: UIContentConfiguration?\n}\n")),"\n",l.createElement(t.p,null,"The documentation states that:"),"\n",l.createElement(t.blockquote,null,"\n",l.createElement(t.p,null,"Setting a content configuration replaces the existing ",l.createElement(t.code,null,"contentView")," of the cell with a new content\nview instance from the configuration, or directly applies the configuration to the existing content\nview if the configuration is compatible with the existing content view type."),"\n"),"\n",l.createElement(t.p,null,"This means that it'll rip out it's contentView, and use the view provided by your\n",l.createElement(t.code,null,"UIContentConfiguration")," in it's ",l.createElement(t.code,null,"makeContentView()")," method. No more subclasses of\n",l.createElement(t.code,null,"UICollectionViewCell")," ðŸŽ‰!!!"),"\n",l.createElement(t.p,null,"Now that we know this, our registration and dequeue process looks much like the same as before,\nbut applying the configuration instead:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"let simpleCellRegistration = UICollectionView.CellRegistration\n    <UICollectionViewCell, UIContentConfiguration> { (cell, _, configuration) in\n    cell.contentConfiguration = configuration\n}\n\nlet dataSource = UICollectionViewDiffableDataSource<Section, Item>\n    .init(collectionView: collectionView) { (cv, indexPath, item) -> UICollectionViewCell? in\n    switch item {\n    case .simpleCell(let configuration):\n        return cv.dequeueConfiguredReusableCell(\n            using: simpleCellRegistration,\n            for: indexPath,\n            item: configuration\n        )\n        ...\n    }\n}\n")),"\n",l.createElement(t.p,null,"We do need to change how the dataSource's ",l.createElement(t.code,null,"Item")," is defined:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"enum Item: Hashable {\n    case simpleCell(SimpleCell.Configuration)\n}\n")),"\n",l.createElement(t.p,null,"Now we store the actual ",l.createElement(t.code,null,"SimpleCell.Configuration")," we defined previously."),"\n",l.createElement(t.p,null,"Also, UIKit is now in charge for some changes on that configuration: in the case for a state change,\nUIKit will immediatly call SimpleCell.Configuration ",l.createElement(t.code,null,"updated(for state:)")," method, which in turn will\nupdate the configuration on the SimpleCell.View and call ",l.createElement(t.code,null,"configureFor(configuration:)"),", so everything is\nkept in sync."),"\n",l.createElement(t.p,null,"Moreover, if there's a data change and we need to call ",l.createElement(t.code,null,"reconfigureItems()")," on the dataSource,\nthe cell will be dequeued, which will set the configuration again, calling ",l.createElement(t.code,null,"updated(for state:)"),"."),"\n",l.createElement(t.p,null,"This here shows the diagram of the different steps involved in the dequeueing and displaying\nof the cells."),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 100.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAC4jAAAuIwF4pT92AAAC2UlEQVR42oVTa2/SYBTmN/ppP8APJn5wJs5PatSYJUaHxMucbm5uczAiAxmwAi6EjXEtTIZzGpBLKbeWa+m9b0s9geDmZNuT5s3p2/fpOc953mNotloqQlmi7I0n/HjSj6fgCR6mOY6ThhD+A3zSNC2Xyxn6LKvruieRvLHw4f6m7e66ZWbNMr24glSV5/l2pwPn9H8x2imXywaW4yD6SVSsoZgznrIdxLeiuDOGq5qmqqqiKHB0MMZ5MvwedpHI6HJfYuhOo6QjVhN7SBb0C3BKFiWF69YKvjvk/hMy/Ky8P1sJPy/5blcPN0RZ6/cZUDjSiRCaQOZ79XrkKY2b6ISxib+kk6+pyCx1bBdllWX7QOOHABUTyoZIVAaSMmB5udlhZKQL8kDR9KvLFkRJFnpUxtI6+Ux9t5WT6+1fTvporVOKqJqOkILGUIc4VzZi22Rua4rAbtYOZmuhh5Xgg7ztGhmb50TE9LqAdrvNMAzUyA59PZNZEFUkcbU030iztXSXTAlUhqulhA4xsWaw5kxmUWT6vVK1WqXpfLl8ks1WaYqo1atUHZosyzIckMYYWX1K1tRBKB4wLj4yO95vbi+v2uYtzqUli2nR/KJSIQuFYjabJQiiAFGx2Gw2QUWr1YIWkCRpUBR0ks3sBBzBqD8QxnzBbViDEd9uyMMwvcEZQMJR2+DajTWDgZrW53lOFLsMU6doQZLgFVzQB1dZNUBoL3M853AteL+atj1Gh2se87/F/K/cGN1qgc7LBkNX0e63o8fWLZMLMzo9c8CH1ekxfnFX63WOZS8jQ0tBCcOyHC90e0y9QUHFfZg1Xvg7RheSwYofRcK6d+COJx3h6GYg6E4kHZGYO47DndYmYTQhYIFB11R7ND5lejP9ceOB1X7Pap/5ZL3+bvnWynq10eA5TlUvLrtYKISSyVWX2+L1mTGveccL68YOZvX5f+fz5CRAToqicBz/A46XM3fO14QhAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Diagram of the process after migrating"\n        title="title YEAH"\n        src="/static/5c42fdd50362ec2c7263fabd38ff0636/7d769/diagram1.png"\n        srcset="/static/5c42fdd50362ec2c7263fabd38ff0636/5243c/diagram1.png 240w,\n/static/5c42fdd50362ec2c7263fabd38ff0636/ab158/diagram1.png 480w,\n/static/5c42fdd50362ec2c7263fabd38ff0636/7d769/diagram1.png 960w,\n/static/5c42fdd50362ec2c7263fabd38ff0636/87339/diagram1.png 1440w,\n/static/5c42fdd50362ec2c7263fabd38ff0636/afa98/diagram1.png 1609w"\n        sizes="(max-width: 960px) 100vw, 960px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(t.p,null,"We really are doing the same steps as before, just in a different order. Instead of dequeueing\nthe cell, creating the ViewModel and then assigning it to the cell, we are creating the Configuration\nand assigining it to the cell, which in turn creates the content view under the hood. However,\nnotice here we're merging the creation and configuration of the view in a single step, and that may\nhave some impact on the layout definition, since now we new can't create a cell on its own,\nand it needs to have a configuration ready beforehand."),"\n",l.createElement(t.p,null,"So far we saw how we create a cell using the configuration. But if we tap on the cell, the background\nis not being changed. This is because we lack the last piece of the puzzle: Updates."),"\n",l.createElement(t.h3,null,"How are changes in the configuration affecting the view?"),"\n",l.createElement(t.p,null,"As we can see from the updated(for state:) method, we can mutate the configuration whenever a change\nis needed. This in turn will change the instance of the configuration defined in SimpleCellView.\nBut that does not change any views yet. So we need to set a trigger for that to happen. So we add\na ",l.createElement(t.code,null,"didSet")," trigger to the SimpleCellView's configuration:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public var configuration: UIContentConfiguration {\n    didSet {\n        guard let oldConfig = oldValue as? Configuration,\n              let config = configuration as? Configuration else { return }\n        if oldConfig != config {\n            self.configureFor(configuration: config)\n        }\n    }\n}\n")),"\n",l.createElement(t.p,null,"Here we make sure that if the configuration really changed, we call\n",l.createElement(t.code,null,"configureFor(configuration: config)"),". To do this, we need to make ",l.createElement(t.code,null,"Configuration"),"\nconform to ",l.createElement(t.code,null,"Equatable")," as well. But aside from that, we just need to call\n",l.createElement(t.code,null,"configureFor(configuration:)")," again to see the change take effect."),"\n",l.createElement(t.p,null,"Here's a diagram of the update process"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 85.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAC4jAAAuIwF4pT92AAACgElEQVR42oVT+0/aUBj1v91vS5YsW7b9oG7zgY/FYdRsLg51oEKxlAJbzMTh6BQR1MwtKLqBKINZ6ItyWx6yUwpCFhJPbm6+lHu+79xzLn08z+uaJkpS6OAwGDvYjMWD+/FgzFjc0fdyuaw1QQgpt1Eqler1ejKZ7EPVaDSKknRv7t0Dm/2Jfe3Rh9XHy6v3F5Yfvl/GUVVVJUnSdb3RBpjYLy4u+kqqikolxLXNUeEdLBT0t4hzm/PuRCrVCoDJtVrNZN7c3HTIapOMTxW9oum6UirlcjnMIZoGYqMXuiY3ZYuyMuhwvlhzD65QAw4Xin6H0+Kk0cXQrapGO0KwK4pSaTbtkAVZHlhxjdHeYcoz6vaO0ewQRVsoD+5cLMIQCcdkWYZ+URTN+3fLbuh6jWhVRSXXBYHo1TLBgPodsk0y0QgX3drZ/xLeC34O+XdjofDeZiQerjVRrVbNAjTsncmtO0vi0PTTybfP55YmZpfGZxbHR2aeTc0PQTbfBMQLgoBJEJ/P50HJZDKtyZB4cv4TK5E8/pE4Sv5KJM6Oz36fIIXbhG5hxtaRDT2FYqFQ5P/ksmfnSb74ly9cC6Jg6KzXblv0jkpWJOvC8Bv7K6dvcYVZWGNt07aRecdr/JpKpbLZLDTDZ1M8zG/JNslqWXX77OyGa/NrYCPEbnGf1gMOdoPCdeAWEjILvY3/XxgcxQuTZDmXzxPjv6Djyx1RwT3zhU2uM1ZvYIrxTbgZK/tx0sPOsgH0gDQj8S5AAijpdLodlaL0r1IWxj9K+8YYv8Xjf+n2WtyMSTZP95h8enp6dXUFV3YP4tx+rLVixh49PIQrcOvy8jLTBdAQdTQa/QfjyIlrzdfncQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Update Diagram"\n        title=""\n        src="/static/82376bdce6c5d6138f7dbff97f8a9059/7d769/diagram2.png"\n        srcset="/static/82376bdce6c5d6138f7dbff97f8a9059/5243c/diagram2.png 240w,\n/static/82376bdce6c5d6138f7dbff97f8a9059/ab158/diagram2.png 480w,\n/static/82376bdce6c5d6138f7dbff97f8a9059/7d769/diagram2.png 960w,\n/static/82376bdce6c5d6138f7dbff97f8a9059/87339/diagram2.png 1440w,\n/static/82376bdce6c5d6138f7dbff97f8a9059/afa98/diagram2.png 1609w"\n        sizes="(max-width: 960px) 100vw, 960px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(t.p,null,"And thats really it! Here you can se the complete code."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"public enum SimpleCell {\n    public struct Configuration: UIContentConfiguration, Identifiable, Equatable {\n        public let id: String\n        public let photo: UIImage\n        public let title: String\n        public let subtitle: String?\n\n        private(set) var state: UICellConfigurationState?\n\n        public init(\n            id: String,\n            photo: UIImage,\n            title: String,\n            subtitle: String?,\n            state: UICellConfigurationState? = nil\n        ) {\n            self.id = id\n            self.photo = photo\n            self.title = title\n            self.subtitle = subtitle\n            self.state = state\n        }\n\n        public func makeContentView() -> UIView & UIContentView {\n            View(configuration: self)\n        }\n\n        public func updated(for state: UIConfigurationState) -> SimpleCell.Configuration {\n            var mutableCopy = self\n            if let cellState = state as? UICellConfigurationState {\n                mutableCopy.state =  cellState\n            }\n            return mutableCopy\n        }\n\n    }\n\n    public class View: UIView & UIContentView {\n        public var configuration: UIContentConfiguration\n        private var titleLabel: UILabel!\n        private var subtitleLabel: UILabel!\n        private var photoImageView: UIImageView!\n\n        init(configuration: Configuration) {\n            self.configuration = configuration\n            super.init(frame: .zero)\n            ...\n            // Layout Code\n\n            configureFor(configuration: configuration)\n        }\n\n        public func configureFor(configuration: Configuration) {\n            titleLabel.text = configuration.title\n            subtitleLabel.text = configuration.subtitle\n            photoImageView.image = configuration.photo\n\n            if let state = configuration.state {\n                backgroundColor = {\n                    if state.isSelected {\n                        return .cellSelectionBackgroundColor\n                    } else if state.isHighlighted {\n                        return .systemGray3\n                    } else {\n                        return .defaultBackgroundColor\n                    }\n                }()\n            } else {\n                backgroundColor = .defaultBackgroundColor\n            }\n        }\n    }\n}\n")),"\n",l.createElement(t.h2,null,"Bonus Track: SwiftUI"),"\n",l.createElement(t.p,null,'You might be wondering: "is this change worth it? What\'s in it for me?"'),"\n",l.createElement(t.p,null,"Moving to this architecture GREATLY improves the experience when bridging these views to SwiftUI.\nIt should be as simple as:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-swift"},"import SwiftUI\n\nextension SimpleCell {\n\n    struct SwiftUIView: UIViewRepresentable {\n\n        let config: Configuration\n\n        func makeUIView(context: Context) -> SimpleCell.View {\n            config.makeContentView() as! SimpleCell.View\n        }\n\n        func updateUIView(_ uiView: SimpleCell.View, context: Context) {\n            uiView.configureFor(configuration: config)\n        }\n\n        typealias UIViewType = SimpleCell.View\n    }\n}\n")),"\n",l.createElement(t.p,null,"A little more of code should be required to handle updates to this view, but should not be hard,\nlet's leave that as homework ðŸ˜…."),"\n",l.createElement(t.p,null,"This data-driven approach trickling down in UIKit it's greatly appreciated and makes it easy to maintain\nUIKit projects."),"\n",l.createElement(t.h2,null,"Conclusion"),"\n",l.createElement(t.p,null,"With that, is as simple as changing types wherever we used ",l.createElement(t.code,null,"SimpleCollectionViewCell")," to the new\n",l.createElement(t.code,null,"SimpleCell.View")," and ",l.createElement(t.code,null,"SimpleCollectionViewCell.ViewModel")," to ",l.createElement(t.code,null,"SimpleCell.Configuration"),"."),"\n",l.createElement(t.p,null,"And that's it! Using that structure we can now implement the same things we previously had, without\nthe hassle of having all the state properties attached to the view, all while relying on UIKit to do\nthe heavy lifting of deciding when to update content and state."),"\n",l.createElement(t.h3,null,"Moving on from here"),"\n",l.createElement(t.p,null,"This covers how we would implement a custom ",l.createElement(t.code,null,"UIContentConfiguration"),".\nFor many cases, though, using the  stock ",l.createElement(t.code,null,"UIListContentConfiguration")," and a plain ",l.createElement(t.code,null,"UICollectionViewListCell"),"\nmay be enough. You can read more about it on ",l.createElement(t.a,{href:"https://www.wwdcnotes.com/notes/wwdc20/10027/"},"WWDC notes")," and\nfrom the ",l.createElement(t.a,{href:"https://developer.apple.com/videos/play/wwdc2020/10027/"},"WWDC 2020 Session")," itself"),"\n",l.createElement(t.p,null,"There is one final caveat: we're currently using the whole Configuration struct as the Item for the\n",l.createElement(t.code,null,"UICollectionDiffableDataSource<Section, Item>"),", instead of asigning it the ID.\nThis works, but according to apple's principles it may lead to bad performance or ocasional crashing."),"\n",l.createElement(t.p,null,"Plus, using only the ID as a reference would allow us to use ",l.createElement(t.code,null,"reconfigureItems"),",\nfirst introduced in iOS 15, to reload any changes on a cell using this same technique."),"\n",l.createElement(t.p,null,"So head on to our next article, where we discuss how to implement a data source using this same\nstructure, but relying on IDs or simple enums as the data source items instead of the whole Configuration object."),"\n",l.createElement(t.p,null,"Cheers!"))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,i.ah)(),e.components);return t?l.createElement(t,e,l.createElement(a,e)):a(e)},r=n(4765);function c(e){return l.createElement(r.Z,e,l.createElement(o,e))}r.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-content-configuration-content-configuration-mdx-c9430dafe45ad7fcb0f9.js.map